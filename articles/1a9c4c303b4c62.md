---
title: "【Flutter】GoRouterのTips 5選"
emoji: "💨"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [Flutter,GoRouter]
published: false
---

Navigator2.0が出てからしばらく経ちましたが、対応されているでしょうか？

ぶっちゃけWeb版を利用しなければ、Navigator1.0のままでも問題なくアプリを組むことは出来ますが、
Web対応や今後のために宣言的ナビゲーションのNavigator2.0の利用がどんどん増えている印象があります。

今回はNavigator2.0に対応したパッケージの中でも
公式傘下パッケージで人気の高い`go_router`についてのTipsをまとめてみます。

## 起動時のスプラッシュ表示

起動中はローディング表示で、起動後に各画面にリダイレクトしたい場合

## プラットフォーム毎の遷移アニメーション

遷移アニメーションを作成する際、`buildPage`を利用する場合があるが、
アニメーションをカスタムしようとするとiOSでスライドバックできない。

下記のようにプラットフォーム別に対応する必要がある

## go_routerの画面遷移をログ出力

### コンソール出力 - デバッグログ

コンソール上にデバッグログのみを出力するのであれば、
下記のように`debugLogDiagnostics`を指定するだけで対応可能です。

```dart
GoRouter(
    // `debugLogDiagnostics`を指定するのみでコンソール上に表示される
	debugLogDiagnostics: true,
    routes: router.routes,
  );
```

コンソール上には下記のように出力されます。

> [GoRouter] Full paths for routes:
>              => /
>              => /dashboard
>              => /item
> [GoRouter] redirecting to RouteMatchList(/dashboard)
> [GoRouter] going to /item

### 外部出力 - 例：Firebase Analytics

リリース後のアプリの分析の際に、
ユーザーがどの画面を多く利用しているかを調査するため、Firebase Analyticsなどのサービスを利用することもあると思います。

こういった場合、アプリ内で`ShellRoute`を利用しているか否かで対応方法を変える必要が出てきます。

#### 利用していない場合

`ShellRoute`などを利用して、ネストしていない場合、
用意されている`observers`に通知処理を追加すれば問題なく検知してくれます。

```dart
GoRouter(
    routes: router.routes,
    // `observers`に指定
    observers: [AnalyticsRouterObserver()],
  );
```

指定するObeserverは`NavigatorObserver`を継承すれば、下記のように好きなように記載することができます。
遷移前のロケーションも取得できるので、導線もわかりやすくて使い勝手がよいですね

```dart
class AnalyticsRouterObserver extends NavigatorObserver {
  @override
  void didPush(
    Route<dynamic> route,
    Route<dynamic>? previousRoute,
  ) {
    analyticsService.routerEvent('didPush: $route');
  }

  @override
  void didPop(Route<dynamic> route, Route<dynamic>? previousRoute) {
    analyticsService.routerEvent('didPop: $route');
  }

  @override
  void didRemove(Route<dynamic> route, Route<dynamic>? previousRoute) {
    analyticsService.routerEvent('didRemove: $route');
  }

  @override
  void didReplace({Route<dynamic>? newRoute, Route<dynamic>? oldRoute}) {
    analyticsService.routerEvent('didReplace: $route');
  }
}
```



#### 利用している場合

`ShellRoute`を利用して、ネストしたルーティング処理を行っている場合、
`observers`による処理が検知されなくなってしまいます。

そのため、`observers`を利用せずに自前で現在のロケーションを監視し続ける方法で対応します。



## NavigationBarとNavigationRailを端末サイズに合わせて変更したい

どちらかというと`adaptive_scaffold`の内容だけど。。。一応
